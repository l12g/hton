!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).hton={})}(this,(function(e){"use strict";function t(e,...t){return"function"==typeof e?e.call(null,...t):e}const n=()=>{};function o(e,t){const n=new Function(...["ctx",`with(ctx){return ${t}}`]);return()=>n(e)}function r(e,t){if(u(e)&&(e.$next||(e.$next=e.nextElementSibling),t(e),function(e){return u(e)&&[1,11].includes(e.nodeType)}(e)))if(s(e))!function(e,t){[...e.content.childNodes].forEach((e=>r(e,t)))}(e,t);else if(!l(e,"for")&&!(l(e,"if")||l(e,"elseif")||l(e,"else")))for(const n of e.childNodes)r(n,t)}function c(e,t){const n=Object.keys(t);return new Proxy(t,{has:()=>!0,get:(t,o,r)=>n.includes(o)?t[o]:e[o],set:(t,o,r)=>(n.includes(o)?t[o]=r:e[o]=r,!0)})}function i(e){return u(e)&&"INPUT"===e.tagName}function s(e){return u(e)&&"TEMPLATE"===e.tagName}function u(e){return e&&[1,3,11].includes(e.nodeType)}function f(e){return"_"+e}function l(e,t){return e.hasAttribute(f(t))}function a(e,t){return e.getAttribute(f(t))}function d(e,t){return e.removeAttribute(f(t))}function m(e){return new Text("")}function h(e){[...e.childNodes].forEach(h),e.$clears&&e.$clears.forEach(t),e.remove()}function p(e,{dom:n,ctx:r,effect:c},i){const s=a(n,e);if(d(n,e),!s)return;if(!i)return;const u=o(r,s);b(n,c((()=>{i(t(u),s)})))}function b(e,t){e.$clears.push(t)}const g=function(...e){return(...t)=>{[...e].reduceRight(((e,n)=>{if(null===e)return null;const o=n.apply(null,e);return null===o?null:void 0===o?[...t]:Array.isArray(o)?o:[o]}),[...t])}}((function(e){for(const t of e.dom.attributes)if(/^_/.test(t.name)){const n=t.name.slice(1);p(n,e,(t=>{e.dom.setAttribute(n,t)}))}p("attr",e,(t=>{Object.keys(t).forEach((n=>{const o=t[n];!1===o||null==o?e.dom.removeAttribute(n):e.dom.setAttribute(n,o)}))}))}),(function(e){p("ref",e,(n=>{t(n,e.dom)}))}),(function(e){const{effect:t,dom:n,ctx:o}=e,r=f("model"),c=n.getAttribute(r);if(n.removeAttribute(r),!c)return;const s=i(u=n)&&"checkbox"===u.getAttribute("type")||function(e){return i(e)&&"radio"===e.getAttribute("type")}(n);var u;const l=s?"click":"input",a=new AbortController;n.addEventListener(l,(e=>{o[c]=s?e.target.checked:e.target.value}),{singal:a.signal}),b(n,(()=>a.abort())),b(n,t((()=>{switch(n.tagName){case"INPUT":case"TEXTAREA":s?n.checked=!!o[c]:n.value=o[c];break;case"SELECT":n.selectedIndex=o[c]}})))}),(function(e){let t;return p("on",e,(n=>{t&&t.abort(),t=new AbortController,Object.keys(n).forEach((o=>{e.dom.addEventListener(o,n[o],{signal:t.signal})}))}))}),(function(e){p("style",e,(t=>{Object.keys(t).forEach((n=>{const o=t[n];!1===o||null==o?e.dom.style.removeProperty(n):e.dom.style.setProperty(n,o)}))}))}),(function(e){p("class",e,(t=>{Object.keys(t).forEach((n=>{t[n]?e.dom.classList.add(n):e.dom.classList.remove(n)}))}))}),(function(e){p("html",e,(t=>{e.dom.innerHTML=t}))}),(function(e){return p("text",e,(t=>{e.dom.innerText=t}))}),(function(e){if(!l(e.dom,"if"))return;const{dom:n,ctx:c,effect:i}=e,u=a(n,"if");d(n,"if");const f=m();n.before(f);const h=(e,t)=>{const n=s(e)?e.content:new DocumentFragment,r=s(e)?[...e.content.childNodes]:[e];return s(e)||r.forEach((e=>n.appendChild(e))),{ower:n,nodes:r,tick:t?o(c,t):()=>!0}},p=[h(n,u)];let y=n.$next;for(;y;){const e=a(y,"elseif")||l(y,"else");if(!e)break;p.push(h(y,e)),y.remove(),d(y,"else"),d(y,"elseif"),y=y.$next}p.forEach((t=>{t.nodes.forEach((n=>{t.ower.appendChild(n),r(n,(t=>{g({...e,dom:t})}))}))})),b(n,i((()=>{let e=-1;for(let n=0;n<p.length;n++){const o=p[n];-1===e&&t(o.tick)&&(e=n),e===n?f.after(o.ower):o.nodes.forEach((e=>o.ower.appendChild(e)))}})))}),(function(e){const{dom:n,ctx:i,effect:u}=e,f=a(n,"for");if(!f)return;d(n,"for");const l=m();n.replaceWith(l);const p=document.createElement("template");p.innerHTML=s(n)?n.innerHTML:n.outerHTML;const b=f.split(/\bin\b/).map((e=>e.trim())),y=new Error("for must be like 'k,v in list (for object) or item in list (for array)'");let x="",E="",k="";if(2===b.length){x=b[1];const e=b[0].split(",").map((e=>e.trim()));if(0===e.length)throw y;if(1===e.length)k=e[0];else{if(2!==e.length)throw y;k=e[0],E=e[1]}}else{if(1!==b.length)throw y;x=b[0]}let v=[];const w=o(i,x),A=document.createDocumentFragment();return u((({setCurrent:e}={})=>{v.forEach(h);const n=t(w);t(e,null);(Array.isArray(n)?n.map(((e,t)=>({$key:t,$value:e}))):Object.keys(n).map((e=>({$key:e,$value:n[e]})))).forEach((e=>{const t=p.cloneNode(!0),n={};k&&(n[k]=e.$value),E&&(n[E]=e.$key),r(t,(e=>{g({dom:e,ctx:c(i,n),effect:u})})),A.append(t.content),v=[...A.childNodes]})),l.after(A)})),null}),(function(e){if(!u(n=e.dom)||3!==n.nodeType)return;var n;const{dom:r,ctx:c,effect:i}=e;if(!r.parentNode)return null;const s=r.textContent,f=s.match(/\{(.*?)\}/g);if(f){const e=f.map((e=>({match:e,tick:o(c,e.slice(1,e.length-1))})));b(r,i((()=>{r.textContent=e.reduce(((e,n,o)=>e.replace(n.match,t(n.tick))),s)})))}return null}),(function(e){if(!u(e.dom))return null;e.$clears||(e.dom.$clears=[])}));e.__version__="0.0.2-alpha.0",e.create=function(e){const o=new Map;let c=null;const i={setCurrent:e=>c=e},s=e=>{const t=c;return c=e,e(i),c=t,e.$clear||n},u=new Proxy({},{has:()=>!0,get(e,t){if(t===Symbol.unscopables)return null;if(o.get(t)||o.set(t,new Set),c){const e=c;o.get(t).add(e),e.$clear=()=>{o.get(t).delete(e)}}return e[t]},set(e,t,n){if(e[t]===n)return!0;if(e[t]=n,o.has(t)){o.get(t).forEach((e=>e(i)))}return!0}}),f=e(u,s)||{};return Object.assign(u,f),{mount:e=>{e="string"==typeof e?document.querySelector(e):e;const n=[];r(e,(e=>{n.push((()=>g({dom:e,ctx:u,effect:s})))})),n.forEach(t)}}}}));
