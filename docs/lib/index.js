!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).hton={})}(this,(function(t){"use strict";function e(t,...e){return"function"==typeof t?t.call(null,...e):t}const n=()=>{};function o(t,e){const n=new Function(...["ctx",`with(ctx){return ${e}}`]);return()=>n(t)}function r(t,e){if(s(t)&&(t.$next||(t.$next=t.nextElementSibling),e(t),function(t){return s(t)&&[1,11].includes(t.nodeType)}(t)))if(u(t))!function(t,e){[...t.content.childNodes].forEach((t=>r(t,e)))}(t,e);else if(!f(t,"for")&&!(f(t,"if")||f(t,"elseif")||f(t,"else")))for(const n of t.childNodes)r(n,e)}function c(t,e){const n=Object.keys(e);return new Proxy(e,{has:()=>!0,get:(e,o,r)=>n.includes(o)?e[o]:t[o],set:(e,o,r)=>(n.includes(o)?e[o]=r:t[o]=r,!0)})}function i(t){return s(t)&&"INPUT"===t.tagName}function u(t){return s(t)&&"TEMPLATE"===t.tagName}function s(t){return t&&[1,3,11].includes(t.nodeType)}function l(t){return"_"+t}function f(t,e){return t.hasAttribute(l(e))}function a(t,e){return t.getAttribute(l(e))}function d(t,e){return t.removeAttribute(l(e))}const{setCurrent:m,getCurrent:h,effect:p}=function(){let t=null;return{setCurrent:e=>t=e,getCurrent:()=>t,effect:e=>{const o=t;return t=e,e(),t=o,e.$clear||n}}}();function g(t){return new Text("")}function b(t){[...t.childNodes].forEach(b),t.$clears&&t.$clears.forEach(e),t.remove()}function y(t,{dom:n,ctx:r},c){const i=a(n,t);if(d(n,t),!i)return;if(!c)return;const u=o(r,i);E(n,p((()=>{c(e(u),i)})))}function E(t,e){t.$clears.push(e)}const x=function(...t){return(...e)=>{[...t].reduceRight(((t,n)=>{if(null===t)return null;const o=n.apply(null,t);return null===o?null:void 0===o?[...e]:Array.isArray(o)?o:[o]}),[...e])}}((function(t){for(const e of[...t.dom.attributes])if(/^_/.test(e.name)){const n=e.name.slice(1);y(n,t,(e=>{t.dom.setAttribute(n,e)}))}y("attr",t,(e=>{Object.keys(e).forEach((n=>{const o=e[n];!1===o||null==o?t.dom.removeAttribute(n):t.dom.setAttribute(n,o)}))}))}),(function(t){y("ref",t,(n=>{e(n,t.dom)}))}),(function(t){const{dom:e,ctx:n}=t,o=l("model"),r=e.getAttribute(o);if(e.removeAttribute(o),!r)return;const c=i(u=e)&&"checkbox"===u.getAttribute("type")||function(t){return i(t)&&"radio"===t.getAttribute("type")}(e);var u;const s=c?"click":"input",f=new AbortController;e.addEventListener(s,(t=>{n[r]=c?t.target.checked:t.target.value}),{singal:f.signal}),E(e,(()=>f.abort())),E(e,p((()=>{switch(e.tagName){case"INPUT":case"TEXTAREA":c?e.checked=!!n[r]:e.value=n[r];break;case"SELECT":e.selectedIndex=n[r]}})))}),(function(t){let e;return y("on",t,(n=>{e&&e.abort(),e=new AbortController,Object.keys(n).forEach((o=>{t.dom.addEventListener(o,n[o],{signal:e.signal})}))}))}),(function(t){y("style",t,(e=>{Object.keys(e).forEach((n=>{const o=e[n];!1===o||null==o?t.dom.style.removeProperty(n):t.dom.style.setProperty(n,o)}))}))}),(function(t){y("class",t,(e=>{Object.keys(e).forEach((n=>{e[n]?t.dom.classList.add(n):t.dom.classList.remove(n)}))}))}),(function(t){y("html",t,(e=>{t.dom.innerHTML=e}))}),(function(t){return y("text",t,(e=>{t.dom.innerText=e}))}),(function(t){if(!f(t.dom,"if"))return;const{dom:n,ctx:c}=t,i=a(n,"if");d(n,"if");const s=g();n.before(s);const l=(t,e)=>{const n=u(t)?t.content:new DocumentFragment,r=u(t)?[...t.content.childNodes]:[t];return u(t)||r.forEach((t=>n.appendChild(t))),{ower:n,nodes:r,tick:e?o(c,e):()=>!0}},m=[l(n,i)];let h=n.$next;for(;h;){const t=a(h,"elseif")||f(h,"else");if(!t)break;m.push(l(h,t)),h.remove(),d(h,"else"),d(h,"elseif"),h=h.$next}m.forEach((e=>{e.nodes.forEach((n=>{e.ower.appendChild(n),r(n,(e=>{x({...t,dom:e})}))}))})),E(n,p((()=>{let t=-1;for(let n=0;n<m.length;n++){const o=m[n];-1===t&&e(o.tick)&&(t=n),t===n?s.after(o.ower):o.nodes.forEach((t=>o.ower.appendChild(t)))}})))}),(function(t){const{dom:n,ctx:i}=t,s=a(n,"for");if(!s)return;d(n,"for");const l=g();n.replaceWith(l);const f=document.createElement("template");f.innerHTML=u(n)?n.innerHTML:n.outerHTML;const h=s.split(/\bin\b/).map((t=>t.trim())),y=new Error("for must be like 'k,v in list (for object) or item in list (for array)'");let E="",k="",w="";if(2===h.length){E=h[1];const t=h[0].split(",").map((t=>t.trim()));if(0===t.length)throw y;if(1===t.length)w=t[0];else{if(2!==t.length)throw y;w=t[0],k=t[1]}}else{if(1!==h.length)throw y;E=h[0]}let v=[];const A=o(i,E),T=document.createDocumentFragment();return p((()=>{v.forEach(b);const t=e(A);e(m,null);(Array.isArray(t)?t.map(((t,e)=>({$key:e,$value:t}))):Object.keys(t).map((e=>({$key:e,$value:t[e]})))).forEach((t=>{const e=f.cloneNode(!0),n={};w&&(n[w]=t.$value),k&&(n[k]=t.$key),r(e,(t=>{x({dom:t,ctx:c(i,n)})})),T.append(e.content),v=[...T.childNodes]})),l.after(T)})),null}),(function(t){if(!s(n=t.dom)||3!==n.nodeType)return;var n;const{dom:r,ctx:c}=t;if(!r.parentNode)return null;const i=r.textContent,u=i.match(/\{(.*?)\}/g);if(u){const t=u.map((t=>({match:t,tick:o(c,t.slice(1,t.length-1))})));E(r,p((()=>{r.textContent=t.reduce(((t,n,o)=>t.replace(n.match,e(n.tick))),i)})))}return null}),(function(t){if(!s(t.dom))return null;t.$clears||(t.dom.$clears=[])}));t.__version__="0.0.2-alpha.2",t.create=function(t){const n=new Map,o=new Proxy({},{has:()=>!0,get(t,e){if(e===Symbol.unscopables)return null;n.get(e)||n.set(e,new Set);const o=h();if(o){const t=o;n.get(e).add(t),t.$clear=()=>{n.get(e).delete(t)}}return t[e]},set(t,e,o){if(t[e]===o)return!0;if(t[e]=o,n.has(e)){n.get(e).forEach((t=>t()))}return!0}}),c=t(o)||{};return Object.assign(o,c),{mount:t=>{if(!(t="string"==typeof t?document.querySelector(t):t))throw new Error("el not found");const n=[];r(t,(t=>{n.push((()=>x({dom:t,ctx:o})))})),n.forEach(e)},state:o}},t.effect=p}));
